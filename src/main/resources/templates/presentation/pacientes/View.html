<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head th:replace="presentation/fragments/fragments :: head">
    <link rel="stylesheet" href="/css/global.css">
    <link rel="stylesheet" href="/css/autentificacion.css">
</head>
<body>
<header th:replace="presentation/fragments/fragments :: header"></header>

<!-- Main Content -->
<div class="container">
    <h1 class="patient-header">
        Doctor - <span class="patient-name" th:text="${session.usuarioId}">Stan Lee</span> - appointment history
    </h1>

    <!-- Filter Section -->
<div class="search-section">
    <form th:action="@{/presentation/pacientes/search}" method="post" class="search-form" th:object="${citasSearch}">
        <div class="search-field">
            <select name="estado" class="form-control">
                <option value="">All</option>
                <option value="Pendiente" th:selected="${citasSearch.estado == 'Pendiente'}">Pending</option>
                <option value="Atendida" th:selected="${citasSearch.estado == 'Atendida'}">Attended</option>
                <option value="Cancelada" th:selected="${citasSearch.estado == 'Cancelada'}">Cancelled</option>
            </select>
        </div>
        <div class="search-field">
            <select name="orden" class="form-control">
                <option value="">All</option>
                <option value="asc" th:selected="${orden == 'asc'}">Mas reciente</option>
                <option value="desc" th:selected="${orden == 'desc'}">Menos reciente</option>
            </select>
        </div>
        <div class="search-field">
            <input type="text" name="paciente" class="form-control" placeholder="Paciente" th:value="${paciente}">
        </div>
        <button type="submit" class="btn-search">Search</button>
    </form>
</div>

    <!-- Appointment List -->
    <div th:if="${not #lists.isEmpty(citasList)}" th:each="cita : ${citasList}" class="appointment-card">
        <div class="patient-column">
            <img th:src="@{${cita.paciente.usuario.getFoto()}}" alt="Doctor" class="doctor-avatar">
            <div class="patient-details">
                <div class="patient-name">
                    <b th:text="${cita.paciente.getUsuario().getNombre()}">John Doe</b>
                </div>
                <div class="patient-info" th:text="${'ID: ' + cita.paciente.id}">ID: 12345</div>
                <div class="patient-contact">
                    <i class="fa-solid fa-envelope"></i> <span th:text="${cita.paciente.email}">patient@email.com</span>
                </div>
            </div>
        </div>

        <div class="appointment-date-column">
            <span class="appointment-date" th:text="${#temporals.format(cita.fecha, 'dd/MM/yyyy') + ' - ' + #temporals.format(cita.horaInicio, 'HH:mm')}">20/02/2025 - 14:00</span>
        </div>

        <div class="appointment-status-column">
            <div th:class="${'appointment-status ' + #strings.toLowerCase(cita.estado)}" th:text="${cita.estado}">Pending</div>
        </div>

        <div class="view-button-column">
            <a th:href="@{'/citas/detalle/' + ${cita.id}}" class="btn-view">
                <i class="fa-solid fa-eye"></i> View
            </a>
            <div th:if="${cita.estado == 'Pending'}" class="action-buttons">
                <a th:href="@{'/citas/atender/' + ${cita.id}}" class="btn-attend">
                    <i class="fa-solid fa-check"></i> Attend
                </a>
                <a th:href="@{'/citas/cancelar/' + ${cita.id}}" class="btn-cancel">
                    <i class="fa-solid fa-times"></i> Cancel
                </a>
            </div>
        </div>

        <!-- Notes section -->
        <div class="doctor-notes-section">
            <form th:action="@{/citas/guardarNotasMedico}" method="post">
                <label for="notasMedico">Anotaciones:</label>
                <textarea id="notasMedico" name="notasMedico" th:text="${cita.notasMedico}"></textarea>
                <input type="hidden" name="citaId" th:value="${cita.id}">
                <button type="submit" class="btn-save-notes">Guardar</button>
            </form>
        </div>
    </div>

    <!-- Empty message if no appointments -->
    <div th:if="${#lists.isEmpty(citasList)}" class="empty-message" style="text-align: center; padding: 30px; background-color: #f8f9fa; border-radius: 8px; margin: 20px 0;">
        <i class="fa-solid fa-calendar-xmark" style="font-size: 48px; color: #6c757d; margin-bottom: 15px;"></i>
        <h3>No hay citas disponibles</h3>
        <p>Actualmente no hay citas registradas en el sistema.</p>
    </div>
</div>

<footer th:replace="presentation/fragments/fragments :: footer"></footer>
</body>
</html>